<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="highfive.nowness.repository.RankBoardRepository">


    <select id="getRank" resultType="RankBoardDTO" parameterType="hashMap">
        SELECT contents.id, contents.user_id, users.nickname, contents.created_datetime,
        contents.views, contents.contents, contents.title, IFNULL(count(likes.id), 0) AS count
        FROM contents
        LEFT JOIN likes ON contents.id = likes.contents_id
        INNER JOIN users ON contents.user_id = users.id
        WHERE contents.blind = 0 AND contents.board_type = 1

        <if test='ST == "day"'>
            AND contents.created_datetime between date_add(now(), interval -1 day ) and now()
        </if>

        <if test='ST == "week"'>
            AND contents.created_datetime between date_add(now(), interval -1 week ) and now()
        </if>

        <if test='ST == "month"'>
            AND contents.created_datetime between date_add(now(), interval -1 month ) and now()
        </if>

        <if test='ST == "year"'>
            AND contents.created_datetime between date_add(now(), interval -1 year ) and now()
        </if>

        GROUP BY contents.id

        <if test='SM == "likeCount"'>
            ORDER BY count desc;
        </if>

        <if test='SM == "viewCount"'>
            ORDER BY views desc;
        </if>
    </select>


    <!--
    <select id="getRank" resultType="RankBoardDTO" parameterType="hashMap">
        SELECT t_contents.id, t_contents.user_id, t_users.nickname, t_contents.created_datetime,
        t_contents.views, t_contents.contents, t_contents.title, IFNULL(count(t_likes.id), 0) AS count
        FROM t_contents
        LEFT JOIN t_likes ON t_contents.id = t_likes.contents_id
        INNER JOIN t_users ON t_contents.user_id = t_users.id
        WHERE t_contents.blind = 0 AND t_contents.board_type = 1

        <if test='ST == "day"'>
            AND t_contents.created_datetime between date_add(now(), interval -1 day ) and now()
        </if>

        <if test='ST == "week"'>
            AND t_contents.created_datetime between date_add(now(), interval -1 week ) and now()
        </if>

        <if test='ST == "month"'>
            AND t_contents.created_datetime between date_add(now(), interval -1 month ) and now()
        </if>

        <if test='ST == "year"'>
            AND t_contents.created_datetime between date_add(now(), interval -1 year ) and now()
        </if>

        GROUP BY t_contents.id

        <if test='SM == "likeCount"'>
            ORDER BY count desc;
        </if>

        <if test='SM == "viewCount"'>
            ORDER BY views desc;
        </if>
    </select>
    -->

    <!--
    <insert id="addTest">
        insert into test (id, name) values (#{id}, #{name})
    </insert>

    <delete id="deleteTest">
        delete from test where id=#{id}
    </delete>
    -->

</mapper>
